<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Leap Motion C API: Rectifying Points Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="leapmotion-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Leap Motion C API
   &#160;<span id="projectnumber">3.1</span>
   </div>
   <div id="projectbrief">The API to the LeapC library.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>LeapC</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="pages.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00020.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Rectifying Points Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example builds on <a class="el" href="a00018.html">Textured Quad Example</a>. Instead of texturing the quad with the uncorrected mage data, this example rectifies the image data to a second texture buffer and uses the result. You will notice that the image no longer fills the entire rectangular area. This is because rays of light that would have filled in the border areas were actually outside the field of view of the camera.</p>
<p>The main changes to this example occur in the display() function. For each pixel in the target texture, the function generates the slopes of the camera ray intersecting that point and looks up the correct brightness value in the uncorrected image buffer (as described in <a class="el" href="a00026.html#rectifypoints">Rectifying Image Points</a>). The result is the a texture containing the rectified image.</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;//display the textured quad</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;void display(void)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  glMatrixMode(GL_MODELVIEW);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  glPushMatrix();</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  glTranslatef(-32, -24, -50); //&quot;Camera&quot; viewpoint</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  glClear(GL_COLOR_BUFFER_BIT);</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  if(imageReady){</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    //Left image</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    for( float row = 0; row &lt; TEX_HEIGHT; row++ ) {</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      for( float col = 0; col &lt; TEX_WIDTH; col++ ) {</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            //Normalize from pixel xy to range [0..1]</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;            LEAP_VECTOR input;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            input.x = col/TEX_WIDTH;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            input.y = row/TEX_HEIGHT;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;            //Convert from normalized [0..1] to ray slopes</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            input.x = (input.x - .5) * MAX_FOV;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            input.y = (input.y - .5) * MAX_FOV;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            LEAP_VECTOR pixel = LeapRectilinearToPixel(*connection,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                                                       eLeapPerspectiveType_stereo_left,</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                                                       input);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;            int dindex = (int)floor(row * TEX_WIDTH + col);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;            int pindex = (int)roundf(pixel.y) * image_width + (int)roundf(pixel.x);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;            if(pixel.x &gt;= 0 &amp;&amp; pixel.x &lt; image_width &amp;&amp; pixel.y &gt;=0 &amp;&amp; pixel.y &lt; image_height){</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;              undistorted_image_left[dindex] = ((char*)image_buffer)[pindex];</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            } else {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;              undistorted_image_left[dindex] = 128;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            }</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    // right image</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    for( float row = 0; row &lt; TEX_HEIGHT; row++ ) {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        for( float col = 0; col &lt; TEX_WIDTH; col++ ) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            //Normalize from pixel xy to range [0..1]</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            LEAP_VECTOR input;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            input.x = col/TEX_WIDTH;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            input.y = row/TEX_HEIGHT;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            //Convert from normalized [0..1] to ray slopes</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            input.x = (input.x - .5) * MAX_FOV;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            input.y = (input.y - .5) * MAX_FOV;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            LEAP_VECTOR pixel = LeapRectilinearToPixel(*connection,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                                       eLeapPerspectiveType_stereo_right,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                                       input);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            int dindex = (int)floor(row * TEX_WIDTH + col);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            int pindex = (int)roundf(pixel.y + image_height) * image_width + (int)roundf(pixel.x);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            if(pixel.x &gt;= 0 &amp;&amp; pixel.x &lt; image_width &amp;&amp; pixel.y &gt;=0 &amp;&amp; pixel.y &lt; image_height){</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;              undistorted_image_right[dindex] = ((char*)image_buffer)[pindex];</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            } else {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;              undistorted_image_right[dindex] = 200;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    DrawImageQuad(0, 0, 64, 24, TEX_WIDTH, TEX_HEIGHT, undistorted_image_left);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    DrawImageQuad(0, 26, 64, 50, TEX_WIDTH, TEX_HEIGHT, undistorted_image_right);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    imageReady = false;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  glFlush();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  glPopMatrix();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  glutSwapBuffers();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;//end of display</div>
</div><!-- fragment --></p>
<p>To rectify an image while taking advantage of a GPU, see <a class="el" href="a00022.html">Rectifying with a Shader Example</a>.</p>
<p>This example is only supported on platforms for which a working version of GLUT exists. It should not be overly difficult to port the example to a different OpenGL-based context, however. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00006.html">Examples</a></li>
    <li class="footer">Generated on Tue Dec 13 2016 15:48:45 for Leap Motion C API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
