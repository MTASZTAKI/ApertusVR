<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Leap Motion C API: Callback Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="leapmotion-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Leap Motion C API
   &#160;<span id="projectnumber">3.1</span>
   </div>
   <div id="projectbrief">The API to the LeapC library.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>LeapC</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="pages.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00008.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Callback Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#samplec">Sample.c</a></li>
<li class="level1"><a href="#ExampleConnectionh">ExampleConnection.h</a></li>
<li class="level1"><a href="#ExampleConnectionc">ExampleConnection.c</a></li>
</ul>
</div>
<div class="textblock"><p>This example demonstrates the basic usage of the LeapC API to get tracking data.</p>
<h1><a class="anchor" id="samplec"></a>
Sample.c</h1>
<p>Sample.c is an example client application that consumes the tracking data &ndash; in this case, by simply printing basic data to stdout.</p>
<p>Sample.C defines three callback functions, one each for OnConnect, OnDevice, and OnFrame. Each of these callback functions are called by ExampleConnection when the LeapC library returns the associated event. The OnConnect callback doesn't have any associated data, but you can use the event to initialize parts of your application that depend on a connection. OnDevice provides the <a class="el" href="a00029.html#a00051" title="Properties of a Leap device. ">LEAP_DEVICE_INFO</a> struct describing the connected device. OnFrame provides the <a class="el" href="a00029.html#a00069" title="A snapshot, or frame of data, containing the tracking data for a single moment in time...">LEAP_TRACKING_EVENT</a> struct that contains all the tracking data (except images) for the latest frame.</p>
<p>Callback functions are invoked directly from the ExampleConnection thread created to service the LeapC message pump. This can be problematic for applications that use UI or graphics libraries that must be called on a particular thread. For such applications, you must implement a means for one thread to hand of data to the other. The best approach is platform dependent. For example, the Windows API provides a SynchronizationContext construct that can be used in some cases. The (Polling Example)[polling-example] demonstrates an approach in which the latest data objects are cached by the servicing thread and the application can access these objects when ready. The (Frame Interpolation Example)[interpolation-example] demonstrates another way around the problem for tracking data, which works because interpolated frames are returned directly to the calling function rather than passing throught the LeapC message pump.</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#undef __cplusplus</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#include &lt;stdio.h&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#include &lt;stdlib.h&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;#include &quot;LeapC.h&quot;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;#include &quot;ExampleConnection.h&quot;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;/** Callback for when the connection opens. */</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;void OnConnect(){</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  printf(&quot;Connected.\n&quot;);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;/** Callback for when a device is found. */</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;void OnDevice(const LEAP_DEVICE_INFO *props){</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  printf(&quot;Found device %s.\n&quot;, props-&gt;serial);</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;/** Callback for when a frame of tracking data is available. */</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;void OnFrame(const LEAP_TRACKING_EVENT *frame){</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  printf(&quot;Frame %lli with %i hands.\n&quot;, (long long int)frame-&gt;info.frame_id, frame-&gt;nHands);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  for(uint32_t h = 0; h &lt; frame-&gt;nHands; h++){</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    LEAP_HAND* hand = &amp;frame-&gt;pHands[h];</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    printf(&quot;    Hand id %i is a %s hand with position (%f, %f, %f).\n&quot;,</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                hand-&gt;id,</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                (hand-&gt;type == eLeapHandType_Left ? &quot;left&quot; : &quot;right&quot;),</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                hand-&gt;palm.position.x,</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                hand-&gt;palm.position.y,</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                hand-&gt;palm.position.z);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  }</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;}</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;int main(int argc, char** argv) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  //Set callback function pointers</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  ConnectionCallbacks.on_connection          = &amp;OnConnect;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  ConnectionCallbacks.on_device_found        = &amp;OnDevice;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  ConnectionCallbacks.on_frame               = &amp;OnFrame;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  OpenConnection();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  printf(&quot;Press Enter to exit program.\n&quot;);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  getchar();</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  return 0;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;//End-of-Sample.c</div>
</div><!-- fragment --></p>
<h1><a class="anchor" id="ExampleConnectionh"></a>
ExampleConnection.h</h1>
<p>ExampleConnection.h defines the public functions that should be called by applications. Any other functions should be considered private.</p>
<p>Typedefs and function pointers for the supported callback functions are also defined here. Sample.c only uses three of the callbacks, but the complete set are defined in this example.</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#ifndef ExampleConnection_h</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#define ExampleConnection_h</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#include &quot;LeapC.h&quot;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;/* Client functions */</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;LEAP_CONNECTION* OpenConnection();</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;void CloseConnection();</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;void CloseConnectionHandle(LEAP_CONNECTION* connectionHandle);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;LEAP_TRACKING_EVENT* GetFrame(); //Used in polling example</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;LEAP_DEVICE_INFO* GetDeviceProperties(); //Used in polling example</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;const char* ResultString(eLeapRS r);</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;/* State */</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;extern bool IsConnected;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;/* Callback function pointers */</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;typedef void (*connection_callback)     ();</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;typedef void (*device_callback)         (const LEAP_DEVICE_INFO *device);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;typedef void (*device_lost_callback)    ();</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;typedef void (*device_failure_callback) (const eLeapDeviceStatus failure_code,</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                                         const LEAP_DEVICE failed_device);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;typedef void (*policy_callback)         (const uint32_t current_policies);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;typedef void (*tracking_callback)       (const LEAP_TRACKING_EVENT *tracking_event);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;typedef void (*image_callback)          (const LEAP_IMAGE_COMPLETE_EVENT *image_complete_event);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;typedef void (*image_error_callback)    (const LEAP_IMAGE_FRAME_REQUEST_ERROR_EVENT *image_error_event);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;typedef void (*log_callback)            (const eLeapLogSeverity severity,</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                                         const int64_t timestamp,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                         const char* message);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;typedef void (*config_change_callback)  (const uint32_t requestID, const bool success);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;typedef void (*config_response_callback)(const uint32_t requestID, LEAP_VARIANT value);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;struct Callbacks{</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  connection_callback      on_connection;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  connection_callback      on_connection_lost;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  device_callback          on_device_found;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  device_lost_callback     on_device_lost;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  device_failure_callback  on_device_failure;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  policy_callback          on_policy;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  tracking_callback        on_frame;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  image_callback           on_image_complete;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  image_error_callback     on_image_request_error;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  log_callback             on_log_message;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  config_change_callback   on_config_change;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  config_response_callback on_config_response;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;};</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;extern struct Callbacks ConnectionCallbacks;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;extern void millisleep(int milliseconds);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;#endif /* ExampleConnection_h */</div>
</div><!-- fragment --></p>
<h1><a class="anchor" id="ExampleConnectionc"></a>
ExampleConnection.c</h1>
<p>ExampleConnection.c demonstrates how to service the LeapC message pump. LeapC gathers events from the Leap Motion service and places them in a queues. Client applications must service this queue by calling <a class="el" href="a00036.html#ga2a8aecad339f0fd339ca22a3e7b389f6" title="Polls the connection for a new event. ">LeapPollConnection()</a>. A good way to do this is in a dedicated thread &ndash; otherwise servicing the message pump may block the application thread, or conversely, fall behind and lose event messages.</p>
<p>The client application calls the OpenConnection() function in ExampleConnection, which calls LeapC functions to establish the connection with the Leap Motion service. If the connection is successful, a new thread is started to run serviceMessageLoop().</p>
<p>ServiceMessageLoop() calls the LeapC <a class="el" href="a00036.html#ga2a8aecad339f0fd339ca22a3e7b389f6" title="Polls the connection for a new event. ">LeapPollConnection()</a> in a tight loop. When tracking frames are being produced, the average time elapsed per loop iteration will equal the service frame rate (about 9ms). A separate handler function is defined for each possible LeapC event, which, in turn, invoke the relevant callback funtions, if the main application has provided one.</p>
<p>Note that ExampleConnection is intended as a simple demonstration only &ndash; not as production-ready code.</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &quot;ExampleConnection.h&quot;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#include &lt;stdlib.h&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#include &lt;stdio.h&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#include &lt;string.h&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;#if defined(_MSC_VER)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  #include &lt;Windows.h&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  #include &lt;process.h&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  #define LockMutex EnterCriticalSection</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  #define UnlockMutex LeaveCriticalSection</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;#else</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  #include &lt;unistd.h&gt;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  #include &lt;pthread.h&gt;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  #define LockMutex pthread_mutex_lock</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  #define UnlockMutex pthread_mutex_unlock</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;#endif</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;//Forward declarations</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;const char* ResultString(eLeapRS r);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;#if defined(_MSC_VER)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;void serviceMessageLoop(void * unused);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#else</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;void* serviceMessageLoop(void * unused);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;#endif</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;void setFrame(const LEAP_TRACKING_EVENT *frame);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;void setDevice(const LEAP_DEVICE_INFO *deviceProps);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;//External state</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;bool IsConnected = false;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;//Internal state</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;bool _isRunning = false;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;LEAP_CONNECTION connectionHandle;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;LEAP_TRACKING_EVENT *lastFrame = NULL;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;LEAP_DEVICE_INFO *lastDevice = NULL;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;//Callback function pointers</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;struct Callbacks ConnectionCallbacks;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;//Threading variables</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;#if defined(_MSC_VER)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;uintptr_t pollingThread;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;CRITICAL_SECTION dataLock;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;#else</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;pthread_t pollingThread;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;pthread_mutex_t dataLock;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;#endif</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;/**</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; * Creates the connection handle and opens a connection to the Leap Motion</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; * service. On success, creates a thread to service the LeapC message pump.</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; */</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;LEAP_CONNECTION* OpenConnection(){</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  eLeapRS result = LeapCreateConnection(NULL, &amp;connectionHandle);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  if(result == eLeapRS_Success){</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    result = LeapOpenConnection(connectionHandle);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    if(result == eLeapRS_Success){</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      _isRunning = true;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;#if defined(_MSC_VER)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      InitializeCriticalSection(&amp;dataLock);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      pollingThread = _beginthread(serviceMessageLoop, 0, NULL);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;#else</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      pthread_create(&amp;pollingThread, NULL, serviceMessageLoop, NULL);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;#endif</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  return &amp;connectionHandle;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;void CloseConnection(){</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  CloseConnectionHandle(&amp;connectionHandle);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;/** Close the connection and let message thread function end. */</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;void CloseConnectionHandle(LEAP_CONNECTION* connectionHandle){</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  LeapDestroyConnection(*connectionHandle);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  _isRunning = false;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;/** Called by serviceMessageLoop() when a connection event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;void handleConnectionEvent(const LEAP_CONNECTION_EVENT *connection_event){</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  IsConnected = true;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  if(ConnectionCallbacks.on_connection){</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    ConnectionCallbacks.on_connection();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;}</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;/** Called by serviceMessageLoop() when a connection lost event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;void handleConnectionLostEvent(const LEAP_CONNECTION_LOST_EVENT *connection_lost_event){</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  IsConnected = false;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  if(ConnectionCallbacks.on_connection_lost){</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    ConnectionCallbacks.on_connection_lost();</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;/**</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; * Called by serviceMessageLoop() when a device event is returned by LeapPollConnection()</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; * Demonstrates how to access device properties.</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; */</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;void handleDeviceEvent(const LEAP_DEVICE_EVENT *device_event){</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  LEAP_DEVICE deviceHandle;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  //Open device using LEAP_DEVICE_REF from event struct.</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  eLeapRS result = LeapOpenDevice(device_event-&gt;device, &amp;deviceHandle);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  if(result != eLeapRS_Success){</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    printf(&quot;Could not open device %s.\n&quot;, ResultString(result));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    return;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  //Create a struct to hold the device properties, we have to provide a buffer for the serial string</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  LEAP_DEVICE_INFO deviceProperties = { sizeof(deviceProperties) };</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  // Start with a length of 1 (pretending we don&#39;t know a priori what the length is).</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  // Currently device serial numbers are all the same length, but that could change in the future</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  deviceProperties.serial_length = 1;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  deviceProperties.serial = malloc(deviceProperties.serial_length);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  //This will fail since the serial buffer is only 1 character long</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  // But deviceProperties is updated to contain the required buffer length</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  result = LeapGetDeviceInfo(deviceHandle, &amp;deviceProperties);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  if(result == eLeapRS_InsufficientBuffer){</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    //try again with correct buffer size</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    free(deviceProperties.serial);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    deviceProperties.serial = malloc(deviceProperties.serial_length);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    result = LeapGetDeviceInfo(deviceHandle, &amp;deviceProperties);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    if(result != eLeapRS_Success){</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      printf(&quot;Failed to get device info %s.\n&quot;, ResultString(result));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      free(deviceProperties.serial);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      return;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  setDevice(&amp;deviceProperties);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  if(ConnectionCallbacks.on_device_found){</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    ConnectionCallbacks.on_device_found(&amp;deviceProperties);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  free(deviceProperties.serial);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  LeapCloseDevice(deviceHandle);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;/** Called by serviceMessageLoop() when a device lost event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;void handleDeviceLostEvent(const LEAP_DEVICE_EVENT *device_event){</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  if(ConnectionCallbacks.on_device_lost){</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    ConnectionCallbacks.on_device_lost();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;/** Called by serviceMessageLoop() when a device failure event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;void handleDeviceFailureEvent(const LEAP_DEVICE_FAILURE_EVENT *device_failure_event){</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  if(ConnectionCallbacks.on_device_failure){</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    ConnectionCallbacks.on_device_failure(device_failure_event-&gt;status, device_failure_event-&gt;hDevice);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;/** Called by serviceMessageLoop() when a tracking event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;void handleTrackingEvent(const LEAP_TRACKING_EVENT *tracking_event){</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  setFrame(tracking_event); //support polling tracking data from different thread</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  if(ConnectionCallbacks.on_frame){</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    ConnectionCallbacks.on_frame(tracking_event);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;/** Called by serviceMessageLoop() when an image complete event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;void handleImageCompleteEvent(const LEAP_IMAGE_COMPLETE_EVENT *image_complete_event){</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  if(ConnectionCallbacks.on_image_complete){</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    ConnectionCallbacks.on_image_complete(image_complete_event);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;/** Called by serviceMessageLoop() when an image reuest error event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;void handleImageRequestErrorEvent(const LEAP_IMAGE_FRAME_REQUEST_ERROR_EVENT *image_request_error_event){</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  if(ConnectionCallbacks.on_image_request_error){</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    ConnectionCallbacks.on_image_request_error(image_request_error_event);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;/** Called by serviceMessageLoop() when a log event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;void handleLogEvent(const LEAP_LOG_EVENT *log_event){</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  if(ConnectionCallbacks.on_log_message){</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    ConnectionCallbacks.on_log_message(log_event-&gt;Severity, log_event-&gt;Timestamp, log_event-&gt;Message);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;/** Called by serviceMessageLoop() when a policy event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;void handlePolicyEvent(const LEAP_POLICY_EVENT *policy_event){</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  if(ConnectionCallbacks.on_policy){</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    ConnectionCallbacks.on_policy(policy_event-&gt;current_policy);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;/** Called by serviceMessageLoop() when a config change event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;void handleConfigChangeEvent(const LEAP_CONFIG_CHANGE_EVENT *config_change_event){</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  if(ConnectionCallbacks.on_config_change){</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    ConnectionCallbacks.on_config_change(config_change_event-&gt;requestID, config_change_event-&gt;status);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;/** Called by serviceMessageLoop() when a config response event is returned by LeapPollConnection(). */</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;void handleConfigResponseEvent(const LEAP_CONFIG_RESPONSE_EVENT *config_response_event){</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  if(ConnectionCallbacks.on_config_response){</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    ConnectionCallbacks.on_config_response(config_response_event-&gt;requestID, config_response_event-&gt;value);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;/**</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; * Services the LeapC message pump by calling LeapPollConnection().</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; * The average polling time is determined by the framerate of the Leap Motion service.</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; */</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;#if defined(_MSC_VER)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;void serviceMessageLoop(void * unused){</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;#else</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;void* serviceMessageLoop(void * unused){</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;#endif</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  eLeapRS result;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  LEAP_CONNECTION_MESSAGE msg;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  while(_isRunning){</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    unsigned int timeout = 1000;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    result = LeapPollConnection(connectionHandle, timeout, &amp;msg);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    if (result != eLeapRS_Success) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      printf(&quot;LeapC PollConnection call was %s.\n&quot;, ResultString(result));</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      continue;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    switch (msg.type){</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      case eLeapEventType_Connection:</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        handleConnectionEvent(msg.connection_event);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        break;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      case eLeapEventType_ConnectionLost:</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        handleConnectionLostEvent(msg.connection_lost_event);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        break;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      case eLeapEventType_Device:</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        handleDeviceEvent(msg.device_event);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        break;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      case eLeapEventType_DeviceLost:</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        handleDeviceLostEvent(msg.device_event);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        break;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      case eLeapEventType_DeviceFailure:</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        handleDeviceFailureEvent(msg.device_failure_event);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        break;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      case eLeapEventType_Tracking:</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        handleTrackingEvent(msg.tracking_event);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        break;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      case eLeapEventType_ImageComplete:</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        handleImageCompleteEvent(msg.image_complete_event);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        break;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      case eLeapEventType_ImageRequestError:</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        handleImageRequestErrorEvent(msg.image_request_error_event);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        break;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      case eLeapEventType_LogEvent:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        handleLogEvent(msg.log_event);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        break;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      case eLeapEventType_Policy:</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        handlePolicyEvent(msg.policy_event);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        break;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      case eLeapEventType_ConfigChange:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        handleConfigChangeEvent(msg.config_change_event);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        break;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      case eLeapEventType_ConfigResponse:</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        handleConfigResponseEvent(msg.config_response_event);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        break;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      default:</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        //discard unknown message types</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        printf(&quot;Unhandled message type %i.\n&quot;, msg.type);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    } //switch on msg.type</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;#if !defined(_MSC_VER)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  return NULL;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;#endif</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;/* Used in Polling Example: */</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;/**</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; * Caches the newest frame by copying the tracking event struct returned by</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; * LeapC.</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; */</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;void setFrame(const LEAP_TRACKING_EVENT *frame){</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  LockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  if(!lastFrame) lastFrame = malloc(sizeof(*frame));</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  *lastFrame = *frame;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  UnlockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;/** Returns a pointer to the cached tracking frame. */</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;LEAP_TRACKING_EVENT* GetFrame(){</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  LEAP_TRACKING_EVENT *currentFrame;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  LockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  currentFrame = lastFrame;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  UnlockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  return currentFrame;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;/**</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; * Caches the last device found by copying the device info struct returned by</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; * LeapC.</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; */</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;void setDevice(const LEAP_DEVICE_INFO *deviceProps){</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  LockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  if(lastDevice){</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    free(lastDevice-&gt;serial);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  } else {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    lastDevice = malloc(sizeof(*deviceProps));</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  *lastDevice = *deviceProps;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  lastDevice-&gt;serial = malloc(deviceProps-&gt;serial_length);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  memcpy(lastDevice-&gt;serial, deviceProps-&gt;serial, deviceProps-&gt;serial_length);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  UnlockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;/** Returns a pointer to the cached device info. */</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;LEAP_DEVICE_INFO* GetDeviceProperties(){</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  LEAP_DEVICE_INFO *currentDevice;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  LockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  currentDevice = lastDevice;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  UnlockMutex(&amp;dataLock);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  return currentDevice;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;//End of polling example-specific code</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;/** Translates eLeapRS result codes into a human-readable string. */</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;const char* ResultString(eLeapRS r) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  switch(r){</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    case eLeapRS_Success:                  return &quot;eLeapRS_Success&quot;;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    case eLeapRS_UnknownError:             return &quot;eLeapRS_UnknownError&quot;;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    case eLeapRS_InvalidArgument:          return &quot;eLeapRS_InvalidArgument&quot;;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    case eLeapRS_InsufficientResources:    return &quot;eLeapRS_InsufficientResources&quot;;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    case eLeapRS_InsufficientBuffer:       return &quot;eLeapRS_InsufficientBuffer&quot;;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    case eLeapRS_Timeout:                  return &quot;eLeapRS_Timeout&quot;;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    case eLeapRS_NotConnected:             return &quot;eLeapRS_NotConnected&quot;;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    case eLeapRS_HandshakeIncomplete:      return &quot;eLeapRS_HandshakeIncomplete&quot;;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    case eLeapRS_BufferSizeOverflow:       return &quot;eLeapRS_BufferSizeOverflow&quot;;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    case eLeapRS_ProtocolError:            return &quot;eLeapRS_ProtocolError&quot;;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    case eLeapRS_InvalidClientID:          return &quot;eLeapRS_InvalidClientID&quot;;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    case eLeapRS_UnexpectedClosed:         return &quot;eLeapRS_UnexpectedClosed&quot;;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    case eLeapRS_UnknownImageFrameRequest: return &quot;eLeapRS_UnknownImageFrameRequest&quot;;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    case eLeapRS_UnknownTrackingFrameID:   return &quot;eLeapRS_UnknownTrackingFrameID&quot;;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    case eLeapRS_RoutineIsNotSeer:         return &quot;eLeapRS_RoutineIsNotSeer&quot;;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    case eLeapRS_TimestampTooEarly:        return &quot;eLeapRS_TimestampTooEarly&quot;;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    case eLeapRS_ConcurrentPoll:           return &quot;eLeapRS_ConcurrentPoll&quot;;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    case eLeapRS_NotAvailable:             return &quot;eLeapRS_NotAvailable&quot;;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    case eLeapRS_NotStreaming:             return &quot;eLeapRS_NotStreaming&quot;;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    case eLeapRS_CannotOpenDevice:         return &quot;eLeapRS_CannotOpenDevice&quot;;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    default:                               return &quot;unknown result type.&quot;;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;/** Cross-platform sleep function */</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;void millisleep(int milliseconds){</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;#ifdef _WIN32</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    Sleep(milliseconds);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;#else</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    usleep(milliseconds*1000);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;#endif</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;//End-of-ExampleConnection.c</div>
</div><!-- fragment --> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="a00006.html">Examples</a></li>
    <li class="footer">Generated on Tue Dec 13 2016 15:48:45 for Leap Motion C API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
